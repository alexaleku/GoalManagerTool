<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>Hello World in Backbone.js</title>
	</head>
	<body>
		<!-- ========= -->
		<!-- Your HTML -->
		<!-- ========= -->
		<section id="todoapp">
			<header id="header">
				<h1>Todos</h1>
				<input id="new=todo" placeholder="What needs to be done" />
				<section id="main">
					<ul id="todo-list"></ul>
				</section>
			</header>
		</section>
		<!-- ========= -->
		<!-- Libraries -->
		<!-- ========= -->
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js" type="text/javascript"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js" type="text/javascript"></script>
		<!-- =============== -->
		<!-- Javascript code -->
		<!-- =============== -->

		<script id="profileTemplate" type="text/template">
			<div class="profile">
			<div class="info">
			<div class="name"><%=title%></div>
			<div class="title"><%=description%></div>
			<div class="background"><%=JSON.stringify(prioriry)%></div>
			</div>
			</div>
		</script>
		<script type="text/javascript">
            /// MODEL

            //var app = {};

            var Profile = Backbone.Model.extend();

            /// COLLECTION

            var ProfileList = Backbone.Collection.extend({
                model : Profile,
                url : 'http://localhost:8080/GoalManagerTool/rest/user/2/goals'
            });
            var profiles = new ProfileList();
           

            /// VIEW

            var ProfileView = Backbone.View.extend({
                tagName : 'li',

                initialize : function() {
                    this.render();
                },

                // использовать темплит с название profileTemplate
                template : _.template($('#profileTemplate').html()),
                render : function() {

                    // explanation:
                    //this.$el.html() установить в этот блок как html следующее
                    //this.template() взять html из темплита - который скомпелировать темплит со сладующими параметрами
                    //this.model.toJSON() - параметры в темплит это джейсон объект - вот мы и передаем модель (тот объект модели что соответствует текущему выхзову кода
                    // - те этот код будет вызываться для каждого элемента коллекции и каждый раз будет посылаться разный (очередной) объект как модель)
                    // вообще можно было из объекта модели вытащить определенные переменныеб вот пример:
                    // this.$el.html(this.model.get('name'))' ('this.model.get('age')') - 'this.model.get('occupation');
                    this.$el.html(this.template(this.model.toJSON()));
                    return this;
                    // enable chained calls

                }
            });

            // renders the full list of todo items calling TodoView for each one.
            var AppView = Backbone.View.extend({
                el : '#todo-list',
                initialize : function() {
                    this.render();
                    //  this.input = this.$('#new-todo');

						}, 
				render : function() {
					profiles.fetch().then(function() {
						console.log(profiles.models);
						_.each(profiles.models, function(profile) {
							console.log(profile);
							var view = new ProfileView({
								model : profile
							});

							$('#todo-list').append(view.render().el);
						});

					});

				}
				});

						appView = new AppView();
            // var ProfileList = Backbone.Collection.extend({
            // model : Profile,
            // initialize : function() {
            // alert("Collection init");
            // }
            // });

            // var ProfileList = Backbone.Collection.extend({
            // model : Profile,
            // url : '/model.json',
            // initialize : function() {
            // alert("Collection init");
            // }
            // });

            //  var profilesView = new ProfileView({model: profiles});
            // var profileList = new ProfileList;
            // console.log(profileList.get(0));

            // var mydata = '';
            // var url = "localhost:8080/GoalManagerTool/rest/user/2/goals";
            // url = 'proxy.php?url=' + url;
            // $.ajax({
            // url : 'model.json',
            // dataType : 'json',
            // success : function(data) {
            // mydata = data;
            // }
            // });

            // function useReturnData(data) {
            // mydata = data;
            // console.log(mydata);
            // };

            // profiles.fetch();
            // profiles.bind('reset', function() {
            // console.log(profiles);
            // });
            //
            // var AppView = Backbone.View.extend({
            // el : '#todo-list',
            //
            // template : _.template($('#profileTemplate').html()),
            // initialize : function() {
            // this.render();
            // },
            //
            // render : function(eventName) {
            // _.each(this.model.models, function(profile) {
            // var profileTemplate = this.template(profile.toJSON());
            // $(this.el).append(profileTemplate);
            // }, this);
            // return this;
            // }
            // });
            //
            // var appView = new AppView({
            // model : profiles
            // });

            // http://localhost:8080/GoalManagerTool/rest/user/2/goals
		</script>

	</body>
</html>
